#   make [test] - builds everything, and runs the tests
#   make build  - just builds everything
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

# Project settings. Change these to match your files
LL_IMPL = llist
LL_TEST = llist_tests
CXX = g++
CC = gcc
CFLAGS += -g -Wall
# Depending on your environment, you may need to include -pthread in your CXXFLAGS
# If you get pthread errors when you run make, try removing the # in the line below
CXXFLAGS += -g -Wall -Wextra -pthread


# Primary build targets.
test : build
	./$(LL_TEST)

build: $(LL_TEST)

clean :
	rm -f gtest_main.a *.o $(LL_TEST)

# Targets for building the hash table test suite
$(LL_IMPL).o : $(LL_IMPL).c $(LL_IMPL).h $(GTEST_HEADERS)
	$(CC) $(CFLAGS) -c $(LL_IMPL).c

$(LL_TEST).o : $(LL_TEST).cpp $(LL_IMPL).h $(GTEST_HEADERS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $(LL_TEST).cpp

$(LL_TEST) : $(LL_IMPL).o $(LL_TEST).o gtest_main.a
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -lpthread $^ -o $@

# Google test framework settings. Don't mess with these!
GTEST_DIR = gtest
GTEST_HEADERS = $(GTEST_DIR)/include/gtest/*.h \
                $(GTEST_DIR)/include/gtest/internal/*.h
GTEST_SRCS_ = $(GTEST_DIR)/src/*.h $(GTEST_HEADERS)
CPPFLAGS += -isystem $(GTEST_DIR)/include

# Targets for building Google Test framework
gtest-all.o : $(GTEST_SRCS_)
	$(CXX) $(CPPFLAGS) -I$(GTEST_DIR) $(CXXFLAGS) -c \
            $(GTEST_DIR)/src/gtest-all.cc

gtest_main.o : $(GTEST_SRCS_)
	$(CXX) $(CPPFLAGS) -I$(GTEST_DIR) $(CXXFLAGS) -c \
            $(GTEST_DIR)/src/gtest_main.cc

gtest_main.a : gtest-all.o gtest_main.o
	$(AR) $(ARFLAGS) $@ $^
